/**
*
*/
var myTableApp=angular.module("myTable",["ngTable"]);myTableApp.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data):/)}]).directive("myTable",["ngTableParams","$filter","$compile",function(t,n,r){var i=function(e){if(!e.length||!_.isObject(e[0])){return[]}return _.map(_.keys(e[0]),function(e){return{title:e,field:e}})};var s=function(e){e.pagination=e.pagination===undefined||e.pagination.toString()!=="false";if(e.selectionMode!=="multiple"){e.selectionCheckbox=false}e.itemsByPage=e.itemsByPage||10;e.truncateLength=e.truncateLength||100;return e};var o=function(e,t,n){for(var r=0,i=e.length;r<i;r++){e[r][t]=n}};return{templateUrl:"/template/my-table.html",replace:true,restrict:"E",scope:{rows:"=",cols:"=?",config:"=?",filter:"=?",csv:"=?exportToCsv"},compile:function(e){var u=e.find("thead")[0].innerHTML;return function(a,f,l,c){a.userScope=a.$parent;var h=function(){var e=a.filter;if(e){return _.filter(a.rows,function(t){return _.values(t).join("").indexOf(e)!==-1})}return a.rows};a.rows=a.rows||[];a.cols=a.cols||i(a.rows);a.config=a.config||{};var p=s(a.config);a.$watch("rows",function(e){if(!a.cols.length){a.cols=i(e)}a.tableParams.reload()});a.$watch("config",function(){p=s(a.config)});a.$watch("filter",function(){a.tableParams.reload()});a.$watch("csv",function(e){if(!e||!_.keys(e).length){a.csv={csvData:"",generate:function(){var e='","';var t='"\n"';var n=_.pluck(a.cols,"title");var r=_.pluck(a.cols,"field");var i=n.join(e);var s=_.map(h(),function(t){return _.map(r,function(e){return t[e]}).join(e)}).join(t);this.csvData=['"',i,t,s,'"'].join("")},link:function(){return"data:text/csv;charset=UTF-8,"+encodeURIComponent(this.csvData)}}}});var d=1;var v={page:1,count:p.itemsByPage};var m={total:h().length,counts:[],getData:function(e,t){var r=h();var i=_.keys(t.sorting()).length?n("orderBy")(r,t.orderBy()):r;if(!p.pagination){t.count(i.length+1)}t.total(i.length);e.resolve(i.slice((t.page()-1)*t.count(),t.page()*t.count()));if(d!==t.page()){d=t.page();a.$emit("paginationChange",d)}},$scope:{$data:{}}};if(!p.pagination){v.count=h().length;m.total=1}a.tableParams=new t(v,m);var g="{ selected: row.isSelected }";if(p.ngClassRow){g=g.replace(" }",", ")+p.ngClassRow.replace("{ ","")}p.ngClassRow=g;var y=function(e){var t=_.where(e,{isSelected:true});var n=_.difference(e,t);a.$emit("selected",t);a.$emit("deselected",n)};a.selectAll=function(){o(h(),"isSelected",true)};a.deselectAll=function(){o(h(),"isSelected",false)};a.isAllSelected=function(){var e=h();return e.length&&_.every(e,function(e){return e.isSelected})};a.toggleAll=function(){var e=h();o(e,"isSelected",!a.isAllSelected());y(e)};a.toggle=function(e,t,n,r){var i=p.selectionMode;if(!i||i==="none"){return}if(i==="single"&&!t.isSelected){a.deselectAll()}t.isSelected=!t.isSelected;a.$emit("selectionChange",t,e,r,n);if(i==="multiple"){y(h())}};f.find("thead").remove();var b=angular.element("<thead/>").html(u);r(b.contents())(a);f.children("table").prepend(b);return f}}}}]).directive("myTableTd",["$compile",function(e){return{restrict:"A",link:function(t,n,r,i){t.$watch("col.format",function(r){if(r){n.html(r(t.value,t.row));e(n.contents())(t.userScope)}});t.$watch("col.click",function(e){if(e){n.unbind("click");n.click(function(n){e(n,t.value,t.row)})}})}}}]);myTableApp.run(["$templateCache",function(e){var t=e.get("ng-table/pager.html");e.put("ng-table/pager.html",t.replace("ng-class=\"{'disabled': !page.active}\"","ng-class=\"{'disabled': !page.active, active: (page.number===params.page()) && (page.type==='page' || page.type==='first' || page.type==='last')}\""))}])
